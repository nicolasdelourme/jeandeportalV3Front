import{A as e,l as s,a,m as t,ae as l,G as o,I as r,H as n,K as u,Q as i,L as c,U as d,V as p,u as v,W as m,D as f,N as y,ad as _}from"./vue-vendor-BHZkLje3.js";import{t as x,o as b,s as g,u as h,F as w}from"./form-vendor-D_96SOpp.js";import{c as k,g as C,t as j}from"./index-BamJDk-5.js";import{b as L,c as z,d as A,F}from"./DefaultLayout.vue_vue_type_script_setup_true_lang-Br6uEOr3.js";import{_ as M}from"./AuthFormWrapper.vue_vue_type_script_setup_true_lang-B8TL4y5H.js";import{_ as S,a as P,b as V,c as R}from"./FormMessage.vue_vue_type_script_setup_true_lang-DUUurZV1.js";import{_ as q}from"./FormDescription.vue_vue_type_script_setup_true_lang-BY5sBFTO.js";import{_ as D}from"./Input.vue_vue_type_script_setup_true_lang-DxIiTCa0.js";import"./ui-vendor-Dpzf4R5k.js";import"./index-j_h2RxZR.js";import"./Label.vue_vue_type_script_setup_true_lang-BNDbxbZU.js";const B={key:0,class:"space-y-6 text-center py-8"},I={key:1,class:"space-y-6 text-center py-4"},N={class:"space-y-2"},Z={class:"text-neutral-600"},H={class:"space-y-3"},U={key:2},W={key:0,class:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg"},G={class:"text-sm text-red-600"},K={class:"relative"},Q={class:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400"},T=["aria-label"],X={key:0,class:"space-y-1"},Y={class:"flex items-center justify-between"},$={class:"text-xs font-medium text-neutral-700"},E={class:"text-xs text-neutral-700"},J={class:"relative"},O={class:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400"},ee=["aria-label"],se={class:"font-bold"},ae={key:3,class:"space-y-6 text-center py-4"},te=e({__name:"ResetPasswordPage",setup(e){const te=l(),le=_(),oe=s(""),re=s(!0),ne=s(!1),ue=s(!1),ie=s(!1),ce=s(""),de=s(!1),pe=s(!1),ve=x(b({password:g({required_error:"Le mot de passe est requis"}).min(8,{message:"Le mot de passe doit contenir au moins 8 caractères"}).regex(/[A-Z]/,{message:"Le mot de passe doit contenir au moins une majuscule"}).regex(/[a-z]/,{message:"Le mot de passe doit contenir au moins une minuscule"}).regex(/[0-9]/,{message:"Le mot de passe doit contenir au moins un chiffre"}),confirmPassword:g({required_error:"Veuillez confirmer votre mot de passe"})}).refine(e=>e.password===e.confirmPassword,{message:"Les mots de passe ne correspondent pas",path:["confirmPassword"]})),{handleSubmit:me,values:fe}=h({validationSchema:ve}),ye=a(()=>{const e=fe.password||"";if(!e)return{score:0,label:"",barColor:"var(--color-neutral-300)",bgColor:"rgba(163, 163, 163, 0.2)"};let s=0;return e.length>=8&&(s+=25),e.length>=12&&(s+=10),/[A-Z]/.test(e)&&(s+=20),/[a-z]/.test(e)&&(s+=20),/[0-9]/.test(e)&&(s+=15),/[^A-Za-z0-9]/.test(e)&&(s+=10),s<60?{score:s,label:"Faible",barColor:"var(--color-primary)",bgColor:"rgba(var(--color-primary-rgb), 0.2)"}:s<80?{score:s,label:"Moyen",barColor:"#f97316",bgColor:"rgba(249, 115, 22, 0.2)"}:{score:s,label:"Fort",barColor:"#22c55e",bgColor:"rgba(34, 197, 94, 0.2)"}}),_e=a(()=>({eye:L.fas?.eye,eyeSlash:L.fas?.["eye-slash"],lock:L.fas?.lock})),xe=e=>_e.value[e],be=a(()=>re.value?"Vérification...":ne.value?ie.value?"Mot de passe réinitialisé !":"Nouveau mot de passe":"Lien invalide");t(async()=>{const e=te.params.token;if(!e)return re.value=!1,ne.value=!1,void(ce.value="Le lien de réinitialisation est invalide. Aucun token fourni.");oe.value=e;try{const s=await k.verifyResetCode(e);ne.value="success"===s.status,"success"!==s.status&&(ce.value=s.message||"Le lien de réinitialisation est invalide ou a expiré.")}catch(s){ne.value=!1,ce.value=C(s)}finally{re.value=!1}});const ge=me(async e=>{ue.value=!0,ce.value="";try{const s=await k.completePasswordReset(oe.value,e.password,e.confirmPassword);"success"===s.status?(ie.value=!0,j.success("Mot de passe réinitialisé avec succès !")):ce.value=s.message||"Une erreur est survenue."}catch(s){ce.value=C(s)}finally{ue.value=!1}}),he=()=>{le.push("/auth?mode=login")},we=()=>{le.push("/auth?mode=forgot-password")};return(e,s)=>(n(),o(z,null,{default:r(()=>[u(M,{title:be.value,subtitle:""},{default:r(()=>[re.value?(n(),i("div",B,[...s[3]||(s[3]=[d("div",{class:"mx-auto w-16 h-16 flex items-center justify-center"},[d("svg",{class:"animate-spin w-10 h-10 text-primary",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[d("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),d("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})])],-1),d("p",{class:"text-neutral-600"},"Vérification du lien de réinitialisation...",-1)])])):ne.value||ie.value?ne.value&&!ie.value?(n(),i("div",U,[ce.value?(n(),i("div",W,[d("p",G,p(ce.value),1)])):c("",!0),d("form",{class:"space-y-4",onSubmit:s[2]||(s[2]=(...e)=>v(ge)&&v(ge)(...e))},[u(v(w),{name:"password"},{default:r(({componentField:e})=>[u(v(S),{class:"gap-1"},{default:r(()=>[u(v(P),{class:"text-sm font-medium text-neutral-700"},{default:r(()=>[...s[7]||(s[7]=[m(" Nouveau mot de passe ",-1)])]),_:1}),u(v(V),null,{default:r(()=>[d("div",K,[d("div",Q,[xe("lock")?(n(),o(v(F),{key:0,icon:xe("lock"),class:"w-4 h-4"},null,8,["icon"])):c("",!0)]),u(v(D),f({type:de.value?"text":"password",placeholder:"••••••••",class:"pl-10 pr-10",autocomplete:"new-password"},e),null,16,["type"]),d("button",{type:"button",class:"absolute right-3 top-1/2 -translate-y-1/2 text-neutral-400 hover:text-neutral-600","aria-label":de.value?"Masquer le mot de passe":"Afficher le mot de passe",onClick:s[0]||(s[0]=e=>de.value=!de.value)},[de.value&&xe("eyeSlash")?(n(),o(v(F),{key:0,icon:xe("eyeSlash"),class:"w-4 h-4"},null,8,["icon"])):xe("eye")?(n(),o(v(F),{key:1,icon:xe("eye"),class:"w-4 h-4"},null,8,["icon"])):c("",!0)],8,T)])]),_:2},1024),v(fe).password?(n(),i("div",X,[d("div",Y,[d("span",$," Force: "+p(ye.value.label),1),d("span",E,p(ye.value.score)+"% ",1)]),d("div",{class:"relative h-2 w-full overflow-hidden rounded-full",style:y({backgroundColor:ye.value.bgColor})},[d("div",{class:"h-full transition-all",style:y({width:`${ye.value.score}%`,backgroundColor:ye.value.barColor})},null,4)],4)])):c("",!0),v(fe).password?c("",!0):(n(),o(v(q),{key:1,class:"text-xs text-neutral-500"},{default:r(()=>[...s[8]||(s[8]=[m(" Au moins 8 caractères avec majuscule, minuscule et chiffre ",-1)])]),_:1})),u(v(R))]),_:2},1024)]),_:1}),u(v(w),{name:"confirmPassword"},{default:r(({componentField:e})=>[u(v(S),{class:"gap-1"},{default:r(()=>[u(v(P),{class:"text-sm font-medium text-neutral-700"},{default:r(()=>[...s[9]||(s[9]=[m(" Confirmer le mot de passe ",-1)])]),_:1}),u(v(V),null,{default:r(()=>[d("div",J,[d("div",O,[xe("lock")?(n(),o(v(F),{key:0,icon:xe("lock"),class:"w-4 h-4"},null,8,["icon"])):c("",!0)]),u(v(D),f({type:pe.value?"text":"password",placeholder:"••••••••",class:"pl-10 pr-10",autocomplete:"new-password"},e),null,16,["type"]),d("button",{type:"button",class:"absolute right-3 top-1/2 -translate-y-1/2 text-neutral-400 hover:text-neutral-600","aria-label":pe.value?"Masquer le mot de passe":"Afficher le mot de passe",onClick:s[1]||(s[1]=e=>pe.value=!pe.value)},[pe.value&&xe("eyeSlash")?(n(),o(v(F),{key:0,icon:xe("eyeSlash"),class:"w-4 h-4"},null,8,["icon"])):xe("eye")?(n(),o(v(F),{key:1,icon:xe("eye"),class:"w-4 h-4"},null,8,["icon"])):c("",!0)],8,ee)])]),_:2},1024),u(v(R))]),_:2},1024)]),_:1}),u(v(A),{type:"submit",color:"primary",rounded:"lg",class:"w-full text-secondary hover:text-secondary",size:"lg",disabled:ue.value},{default:r(()=>[d("span",se,p(ue.value?"Réinitialisation...":"Réinitialiser mon mot de passe"),1)]),_:1},8,["disabled"])],32)])):ie.value?(n(),i("div",ae,[s[11]||(s[11]=d("div",{class:"mx-auto w-16 h-16 bg-green-100 rounded-full flex items-center justify-center"},[d("svg",{class:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])],-1)),s[12]||(s[12]=d("div",{class:"space-y-2"},[d("p",{class:"text-neutral-600"}," Votre mot de passe a été réinitialisé avec succès. Vous pouvez maintenant vous connecter avec votre nouveau mot de passe. ")],-1)),u(v(A),{type:"button",color:"primary",rounded:"lg",size:"lg",class:"w-full text-secondary hover:text-secondary",onClick:he},{default:r(()=>[...s[10]||(s[10]=[d("span",{class:"font-bold"},"Se connecter",-1)])]),_:1})])):c("",!0):(n(),i("div",I,[s[6]||(s[6]=d("div",{class:"mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center"},[d("svg",{class:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})])],-1)),d("div",N,[d("p",Z,p(ce.value),1)]),d("div",H,[u(v(A),{type:"button",color:"primary",rounded:"lg",size:"lg",class:"w-full text-secondary hover:text-secondary",onClick:we},{default:r(()=>[...s[4]||(s[4]=[d("span",{class:"font-bold"},"Demander un nouveau lien",-1)])]),_:1}),u(v(A),{type:"button",variant:"outline",size:"lg",class:"w-full",onClick:he},{default:r(()=>[...s[5]||(s[5]=[d("span",null,"Retour à la connexion",-1)])]),_:1})])]))]),_:1},8,["title"])]),_:1}))}});export{te as default};
