import{A as e,a as t,Q as s,H as a,F as l,Z as r,a5 as n,U as o,G as i,L as u,u as c,W as m,I as d,K as f,l as v,w as p,V as g,ad as y,ae as b,X as x,D as h,m as w,af as k}from"./vue-vendor-BHZkLje3.js";import{a as _,t as R,l as L,g as C,c as A,b as z,d as E,e as j}from"./index-BamJDk-5.js";import{b as I,F as S,d as T,_ as M,c as N,a as F}from"./DefaultLayout.vue_vue_type_script_setup_true_lang-Br6uEOr3.js";import{_ as P,a as U,b as V,c as q}from"./AuthModeToggle.vue_vue_type_script_setup_true_lang-CSKWYj3F.js";import{_ as B,a as D}from"./index-j_h2RxZR.js";import{t as K,o as O,s as W,u as $,F as Z}from"./form-vendor-D_96SOpp.js";import{_ as X,a as Y,b as G,c as H}from"./FormMessage.vue_vue_type_script_setup_true_lang-DUUurZV1.js";import{_ as J}from"./Input.vue_vue_type_script_setup_true_lang-DxIiTCa0.js";import"./ui-vendor-Dpzf4R5k.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-EZWj0bVF.js";import"./FormDescription.vue_vue_type_script_setup_true_lang-BY5sBFTO.js";import"./CalendarPrevButton.vue_vue_type_script_setup_true_lang-DUvcT-d5.js";import"./Label.vue_vue_type_script_setup_true_lang-BNDbxbZU.js";const Q=["aria-valuenow","aria-valuemax"],ee=["aria-label"],te=e({__name:"LinkingProgress",props:{currentStep:{},steps:{default:()=>["welcome","auth","form","success"]}},setup(e){const o=e,i=t(()=>o.steps.indexOf(o.currentStep)),u=e=>e<=i.value,c=e=>e===i.value;return(t,o)=>(a(),s("div",{class:"flex justify-center gap-2 py-4",role:"progressbar","aria-valuenow":i.value+1,"aria-valuemin":1,"aria-valuemax":e.steps.length},[(a(!0),s(l,null,r(e.steps,(t,l)=>(a(),s("div",{key:l,class:n(["transition-all duration-300 rounded-full",[c(l)?"w-6 h-2 bg-primary":u(l)?"w-2 h-2 bg-primary":"w-2 h-2 bg-neutral-300"]]),"aria-label":`Étape ${l+1} sur ${e.steps.length}`},null,10,ee))),128))],8,Q))}}),se={class:"flex flex-col items-center text-center px-6 py-8"},ae={class:"w-20 h-20 rounded-full bg-primary/10 flex items-center justify-center mb-6"},le={class:"w-full max-w-sm mb-8 space-y-3"},re={class:"flex items-center gap-3 text-left p-3 bg-neutral-50 rounded-lg"},ne={class:"w-8 h-8 rounded-full bg-secondary flex items-center justify-center shrink-0"},oe={class:"flex items-center gap-3 text-left p-3 bg-neutral-50 rounded-lg"},ie={class:"w-8 h-8 rounded-full bg-secondary flex items-center justify-center shrink-0"},ue={class:"w-full max-w-sm space-y-3"},ce=e({__name:"LinkingSlideWelcome",props:{isAuthenticated:{type:Boolean}},emits:["login","register","continue"],setup(e,{emit:r}){const n=e,v=r,p=t(()=>({arrowRight:I.fas?.["arrow-right"],link:I.fas?.link,star:I.fas?.star,graduationCap:I.fas?.["graduation-cap"],userPlus:I.fas?.["user-plus"]}));return(e,t)=>(a(),s("div",se,[o("div",ae,[p.value.link?(a(),i(c(S),{key:0,icon:p.value.link,class:"w-10 h-10 fa-xl text-secondary"},null,8,["icon"])):u("",!0)]),t[9]||(t[9]=o("h2",{class:"text-2xl font-bold text-neutral-800 mb-4",style:{"font-family":"Roboto, sans-serif"}}," Bienvenue sur Infocash ! ",-1)),t[10]||(t[10]=o("p",{class:"text-neutral-600 mb-8 max-w-sm",style:{"font-family":"Roboto, sans-serif"}},[m(" Vous étiez abonné à notre ancien service "),o("strong",null,'"Les Emmerdeurs"'),m(" ? Rattachez votre compte en quelques étapes pour conserver tous vos avantages. ")],-1)),o("div",le,[o("div",re,[o("div",ne,[p.value.graduationCap?(a(),i(c(S),{key:0,icon:p.value.graduationCap,class:"w-4 h-4 text-primary"},null,8,["icon"])):u("",!0)]),t[3]||(t[3]=o("span",{class:"text-sm text-neutral-700",style:{"font-family":"Roboto, sans-serif"}}," Accès à vos formations de l'Académie ",-1))]),o("div",oe,[o("div",ie,[p.value.star?(a(),i(c(S),{key:0,icon:p.value.star,class:"w-4 h-4 text-primary"},null,8,["icon"])):u("",!0)]),t[4]||(t[4]=o("span",{class:"text-sm text-neutral-700",style:{"font-family":"Roboto, sans-serif"}}," Récupération de vos étoiles accumulées ",-1))])]),o("div",ue,[n.isAuthenticated?(a(),i(c(T),{key:0,variant:"secondary",size:"lg",rounded:"lg",class:"w-full",onClick:t[0]||(t[0]=e=>v("continue"))},{default:d(()=>[t[5]||(t[5]=o("span",{class:"font-bold",style:{"font-family":"Roboto, sans-serif"}}," Continuer ",-1)),p.value.arrowRight?(a(),i(c(S),{key:0,icon:p.value.arrowRight,class:"ml-2 w-4 h-4"},null,8,["icon"])):u("",!0)]),_:1})):(a(),s(l,{key:1},[t[8]||(t[8]=o("p",{class:"text-sm text-neutral-600 mb-3",style:{"font-family":"Roboto, sans-serif"}}," Avez-vous un compte Infocash ? ",-1)),f(c(T),{variant:"secondary",size:"lg",rounded:"lg",class:"w-full",onClick:t[1]||(t[1]=e=>v("login"))},{default:d(()=>[t[6]||(t[6]=o("span",{class:"font-bold",style:{"font-family":"Roboto, sans-serif"}}," J'ai déjà un compte ",-1)),p.value.arrowRight?(a(),i(c(S),{key:0,icon:p.value.arrowRight,class:"ml-2 w-4 h-4"},null,8,["icon"])):u("",!0)]),_:1}),f(c(T),{variant:"outline",color:"secondary",size:"lg",rounded:"lg",class:"w-full hover:text-primary",onClick:t[2]||(t[2]=e=>v("register"))},{default:d(()=>[p.value.userPlus?(a(),i(c(S),{key:0,icon:p.value.userPlus,class:"mr-2 w-4 h-4"},null,8,["icon"])):u("",!0),t[7]||(t[7]=o("span",{class:"font-bold",style:{"font-family":"Roboto, sans-serif"}}," Créer mon compte ",-1))]),_:1})],64))])]))}}),me={class:"px-6 py-8"},de={class:"text-center mb-6"},fe={class:"text-2xl font-bold text-neutral-800 mb-2",style:{"font-family":"Roboto, sans-serif"}},ve={class:"text-neutral-600",style:{"font-family":"Roboto, sans-serif"}},pe={key:3,class:"space-y-6 text-center"},ge={class:"mx-auto w-16 h-16 bg-secondary rounded-full flex items-center justify-center"},ye={class:"space-y-2"},be={class:"font-medium text-neutral-900"},xe=e({__name:"LinkingSlideAuth",props:{initialMode:{}},emits:["next","back","change-mode"],setup(e,{emit:l}){const r=e,n=l;y(),b();const x=_(),h=v(r.initialMode);p(()=>r.initialMode,e=>{h.value=e,k.value={},z.value=!1,E.value=""});const w=v(!1),k=v({}),z=v(!1),E=v(""),j=t(()=>({arrowLeft:I.fas?.["arrow-left"],circleExclamation:I.fas?.["circle-exclamation"],envelope:I.fas?.envelope})),M=async e=>{w.value=!0,k.value.general="";try{await x.login({email:e.email,password:e.password,rememberMe:e.rememberMe,redirectUrl:"/rattachement"}),R.success("Connexion réussie !"),n("next")}catch(t){L.error("Erreur lors du login:",t),k.value.general=C(t)}finally{w.value=!1}},N=async e=>{w.value=!0,k.value.general="";try{await x.register({firstName:e.firstName,lastName:e.lastName,email:e.email,password:e.password,passwordConfirm:e.confirmPassword,phone:e.phone||null,birthDate:e.birthDate||null}),E.value=e.email,z.value=!0,R.success("Un email de vérification a été envoyé !")}catch(t){L.error("Erreur:",t),k.value.general=C(t)}finally{w.value=!1}},F=()=>{z.value=!1,E.value="",h.value="login",k.value={}},K=async e=>{w.value=!0,k.value.general="";try{const t=await A.forgotPassword(e.email);R.success(t.message),h.value="login"}catch(t){L.error("Erreur:",t),k.value.general=C(t)}finally{w.value=!1}},O=()=>{h.value="forgot-password",k.value={}},W=t(()=>"login"===h.value?{title:"Connectez-vous",subtitle:"pour rattacher votre ancien compte",toggleText:"Vous n'avez pas de compte ?",toggleLink:"Créer un compte"}:"register"===h.value?{title:"Créez votre compte",subtitle:"pour rattacher votre ancien compte",toggleText:"Vous avez déjà un compte ?",toggleLink:"Se connecter"}:{title:"Mot de passe oublié",subtitle:"Entrez votre email pour réinitialiser",toggleText:"Vous vous souvenez de votre mot de passe ?",toggleLink:"Retour à la connexion"});return(e,t)=>(a(),s("div",me,[o("button",{type:"button",class:"flex items-center gap-2 text-neutral-600 hover:text-neutral-800 mb-6 transition-colors",onClick:t[0]||(t[0]=e=>n("back"))},[j.value.arrowLeft?(a(),i(c(S),{key:0,icon:j.value.arrowLeft,class:"w-4 h-4"},null,8,["icon"])):u("",!0),t[2]||(t[2]=o("span",{class:"text-sm",style:{"font-family":"Roboto, sans-serif"}},"Retour",-1))]),o("div",de,[o("h2",fe,g(W.value.title),1),o("p",ve,g(W.value.subtitle),1)]),k.value.general?(a(),i(c(B),{key:0,variant:"destructive",class:"mb-6"},{default:d(()=>[j.value.circleExclamation?(a(),i(c(S),{key:0,icon:j.value.circleExclamation,class:"h-4 w-4"},null,8,["icon"])):u("",!0),f(c(D),{style:{"font-family":"Roboto, sans-serif"}},{default:d(()=>[m(g(k.value.general),1)]),_:1})]),_:1})):u("",!0),"login"===h.value?(a(),i(P,{key:1,"is-submitting":w.value,onSubmit:M,onForgotPassword:O},null,8,["is-submitting"])):"register"!==h.value||z.value?"register"===h.value&&z.value?(a(),s("div",pe,[o("div",ge,[j.value.envelope?(a(),i(c(S),{key:0,icon:j.value.envelope,class:"size-8 text-primary"},null,8,["icon"])):u("",!0)]),o("div",ye,[t[3]||(t[3]=o("h3",{class:"text-lg font-semibold text-neutral-900"}," Vérifiez votre boîte mail ",-1)),t[4]||(t[4]=o("p",{class:"text-sm text-neutral-600"}," Un email de vérification a été envoyé à ",-1)),o("p",be,g(E.value),1),t[5]||(t[5]=o("p",{class:"text-sm text-neutral-600"}," Cliquez sur le lien dans l'email pour activer votre compte, puis revenez ici pour vous connecter. ",-1))]),f(c(T),{type:"button",variant:"secondary",rounded:"lg",class:"w-full",onClick:F},{default:d(()=>[...t[6]||(t[6]=[o("span",{style:{"font-family":"Roboto, sans-serif"}},"Aller à la connexion",-1)])]),_:1}),t[7]||(t[7]=o("p",{class:"text-xs text-neutral-500"}," Pensez à vérifier vos spams si vous ne trouvez pas l'email. ",-1))])):"forgot-password"===h.value?(a(),i(V,{key:4,"is-submitting":w.value,onSubmit:K},null,8,["is-submitting"])):u("",!0):(a(),i(U,{key:2,"is-submitting":w.value,onSubmit:N},null,8,["is-submitting"])),z.value?u("",!0):(a(),i(q,{key:5,text:W.value.toggleText,"link-text":W.value.toggleLink,onToggle:t[1]||(t[1]=e=>"forgot-password"===h.value?(h.value="login",void(k.value={})):(()=>{const e="login"===h.value?"register":"login";h.value=e,k.value={},z.value=!1,E.value="",n("change-mode",e)})())},null,8,["text","link-text"]))]))}}),he={class:"px-6 py-8"},we={class:"relative"},ke={class:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400"},_e={class:"relative"},Re={class:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400"},Le={class:"flex items-start gap-2 p-3 bg-neutral-50 rounded-lg text-sm text-neutral-600"},Ce={class:"font-bold",style:{"font-family":"Roboto, sans-serif"}},Ae=e({__name:"LinkingSlideForm",props:{isSubmitting:{type:Boolean,default:!1},errorMessage:{}},emits:["submit","back"],setup(e,{emit:l}){const r=l,n=K(O({subscriberId:W({required_error:"Le code abonné est requis"}).min(1,{message:"Le code abonné est requis"}).regex(/^[A-Za-z]{2}\d{6}$/,{message:"Format invalide (ex: AB123456)"}),secretKey:W({required_error:"Le token est requis"}).min(1,{message:"Le token est requis"}).regex(/^[A-Za-z0-9]{5}$/,{message:"Format invalide (5 caractères alphanumériques)"})})),{handleSubmit:v}=$({validationSchema:n}),p=t(()=>({arrowLeft:I.fas?.["arrow-left"],user:I.fas?.user,key:I.fas?.key,circleExclamation:I.fas?.["circle-exclamation"],circleInfo:I.fas?.["circle-info"],link:I.fas?.link})),y=e=>p.value[e],b=v(e=>{r("submit",{subscriberId:e.subscriberId.toUpperCase(),secretKey:e.secretKey.toUpperCase()})}),w=e=>{const t=e.target;t.value=t.value.toUpperCase()};return(t,l)=>(a(),s("div",he,[o("button",{type:"button",class:"flex items-center gap-2 text-neutral-600 hover:text-neutral-800 mb-6 transition-colors",onClick:l[0]||(l[0]=e=>r("back"))},[y("arrowLeft")?(a(),i(c(S),{key:0,icon:y,class:"w-4 h-4"},null,8,["icon"])):u("",!0),l[2]||(l[2]=o("span",{class:"text-sm",style:{"font-family":"Roboto, sans-serif"}},"Retour",-1))]),l[6]||(l[6]=o("div",{class:"text-center mb-6"},[o("h2",{class:"text-2xl font-bold text-neutral-800 mb-2",style:{"font-family":"Roboto, sans-serif"}}," Rattachez votre ancien compte "),o("p",{class:"text-neutral-600",style:{"font-family":"Roboto, sans-serif"}},' Entrez vos identifiants "Les Emmerdeurs" ')],-1)),e.errorMessage?(a(),i(c(B),{key:0,variant:"destructive",class:"mb-6"},{default:d(()=>[y("circleExclamation")?(a(),i(c(S),{key:0,icon:y,class:"h-4 w-4"},null,8,["icon"])):u("",!0),f(c(D),{style:{"font-family":"Roboto, sans-serif"}},{default:d(()=>[m(g(e.errorMessage),1)]),_:1})]),_:1})):u("",!0),o("form",{class:"space-y-4",onSubmit:l[1]||(l[1]=x((...e)=>c(b)&&c(b)(...e),["prevent"]))},[f(c(Z),{name:"subscriberId"},{default:d(({componentField:e})=>[f(c(X),{class:"gap-1"},{default:d(()=>[f(c(Y),{class:"text-sm font-medium text-neutral-700"},{default:d(()=>[...l[3]||(l[3]=[m(" Code abonné ",-1)])]),_:1}),f(c(G),null,{default:d(()=>[o("div",we,[o("div",ke,[y("user")?(a(),i(c(S),{key:0,icon:y,class:"w-4 h-4"},null,8,["icon"])):u("",!0)]),f(c(J),h({type:"text",placeholder:"AB123456",class:"pl-10 uppercase",autocomplete:"off",maxlength:"8"},e,{onInput:w}),null,16)])]),_:2},1024),f(c(H))]),_:2},1024)]),_:1}),f(c(Z),{name:"secretKey"},{default:d(({componentField:e})=>[f(c(X),{class:"gap-1"},{default:d(()=>[f(c(Y),{class:"text-sm font-medium text-neutral-700"},{default:d(()=>[...l[4]||(l[4]=[m(" Token ",-1)])]),_:1}),f(c(G),null,{default:d(()=>[o("div",_e,[o("div",Re,[y("key")?(a(),i(c(S),{key:0,icon:y,class:"w-4 h-4"},null,8,["icon"])):u("",!0)]),f(c(J),h({type:"text",placeholder:"A1B2C",class:"pl-10 uppercase",autocomplete:"off",maxlength:"5"},e,{onInput:w}),null,16)])]),_:2},1024),f(c(H))]),_:2},1024)]),_:1}),o("div",Le,[y("circleInfo")?(a(),i(c(S),{key:0,icon:y,class:"w-4 h-4 mt-0.5 flex-shrink-0 text-neutral-400"},null,8,["icon"])):u("",!0),l[5]||(l[5]=o("p",{style:{"font-family":"Roboto, sans-serif"}}," Vous trouverez ces informations dans votre dernier email de renouvellement. ",-1))]),f(c(T),{type:"submit",variant:"secondary",rounded:"lg",class:"w-full",size:"lg",disabled:e.isSubmitting},{default:d(()=>[y("link")?(a(),i(c(S),{key:0,icon:y,class:"mr-2 w-4 h-4"},null,8,["icon"])):u("",!0),o("span",Ce,g(e.isSubmitting?"Rattachement en cours...":"Rattacher mon compte"),1)]),_:1},8,["disabled"])],32)]))}}),ze={class:"flex flex-col items-center text-center px-6 py-8"},Ee={class:"w-20 h-20 rounded-full bg-green-100 flex items-center justify-center mb-6 animate-in zoom-in-50 duration-300"},je={class:"text-neutral-600 mb-6",style:{"font-family":"Roboto, sans-serif"}},Ie={key:0,class:"w-full max-w-sm mb-6"},Se={class:"space-y-2"},Te={class:"flex items-center gap-3"},Me={class:"w-8 h-8 rounded-full bg-primary/20 flex items-center justify-center"},Ne={class:"text-sm font-medium text-neutral-700",style:{"font-family":"Roboto, sans-serif"}},Fe={key:1,class:"w-full max-w-sm mb-8"},Pe={class:"flex items-center justify-center gap-2 p-4 bg-primary/10 rounded-lg"},Ue={class:"text-sm font-medium text-neutral-700",style:{"font-family":"Roboto, sans-serif"}},Ve={class:"w-full max-w-sm space-y-3"},qe=e({__name:"LinkingSlideSuccess",props:{result:{}},setup(e){const n=y(),v=t(()=>({circleCheck:I.fas?.["circle-check"],graduationCap:I.fas?.["graduation-cap"],star:I.fas?.star,arrowRight:I.fas?.["arrow-right"]})),p=e=>v.value[e],b={metaux:{label:"Métaux précieux",variant:"theme-metaux"},portefeuille:{label:"Portefeuille permanent",variant:"theme-portefeuille"},liberte:{label:"Liberté financière",variant:"theme-liberte"},bonus:{label:"Bonus mystère",variant:"theme-bonus"}},x=e=>b[e.slug]||{label:e.name,variant:"default"},h=()=>{n.push("/academie")},w=()=>{n.push("/mon-compte")};return(t,n)=>(a(),s("div",ze,[o("div",Ee,[p("circleCheck")?(a(),i(c(S),{key:0,icon:p,class:"w-10 h-10 text-green-600"},null,8,["icon"])):u("",!0)]),n[5]||(n[5]=o("h2",{class:"text-2xl font-bold text-neutral-800 mb-2",style:{"font-family":"Roboto, sans-serif"}}," Compte rattaché ! ",-1)),o("p",je,g(e.result.message||"Votre ancien compte a été rattaché avec succès."),1),e.result.linkedThemes&&e.result.linkedThemes.length>0?(a(),s("div",Ie,[n[1]||(n[1]=o("p",{class:"text-sm text-neutral-500 mb-3",style:{"font-family":"Roboto, sans-serif"}}," Vous avez maintenant accès à : ",-1)),o("div",Se,[(a(!0),s(l,null,r(e.result.linkedThemes,e=>(a(),s("div",{key:e.id,class:"flex items-center justify-between p-3 bg-neutral-50 rounded-lg"},[o("div",Te,[o("div",Me,[p("graduationCap")?(a(),i(c(S),{key:0,icon:p,class:"w-4 h-4 text-primary"},null,8,["icon"])):u("",!0)]),o("span",Ne,g(x(e).label),1)]),f(c(M),{variant:x(e).variant,class:"text-xs"},{default:d(()=>[...n[0]||(n[0]=[m(" Actif ",-1)])]),_:1},8,["variant"])]))),128))])])):u("",!0),e.result.starsRecovered&&e.result.starsRecovered>0?(a(),s("div",Fe,[o("div",Pe,[p("star")?(a(),i(c(S),{key:0,icon:p,class:"w-5 h-5 text-primary"},null,8,["icon"])):u("",!0),o("span",Ue,[o("strong",null,g(e.result.starsRecovered),1),n[2]||(n[2]=m(" étoiles récupérées ",-1))])])])):u("",!0),o("div",Ve,[f(c(T),{variant:"secondary",size:"lg",rounded:"lg",class:"w-full",onClick:h},{default:d(()=>[n[3]||(n[3]=o("span",{class:"font-bold",style:{"font-family":"Roboto, sans-serif"}}," Accéder à l'Académie ",-1)),p("arrowRight")?(a(),i(c(S),{key:0,icon:p,class:"ml-2 w-4 h-4"},null,8,["icon"])):u("",!0)]),_:1}),f(c(T),{variant:"outline",size:"lg",rounded:"lg",class:"w-full",onClick:w},{default:d(()=>[...n[4]||(n[4]=[o("span",{style:{"font-family":"Roboto, sans-serif"}}," Aller à Mon compte ",-1)])]),_:1})])]))}});class Be extends Error{code;statusCode;constructor(e,t,s){super(e),this.name="LegacyLinkingError",this.code=t,this.statusCode=s}}const De=!1;const Ke=new class{async linkAccount(e){try{let t;{const s=await z.post("/legacy/link",{subscriberId:e.subscriberId,secretKey:e.secretKey});t=this.transformLinkResponse(s)}if("error"===t.status)throw new Be(t.message||"Le rattachement a échoué.",this.getErrorCode(t.message||""));return t}catch(t){if(t instanceof Be)throw t;L.error("Erreur lors du rattachement du compte legacy:",t);const e=E(t);throw new Be(e?.message||"Impossible de rattacher le compte. Veuillez réessayer.","NETWORK_ERROR",j(t))}}async getLinkingStatus(){try{{const e=await z.get("/legacy/status");return this.transformStatusResponse(e)}}catch(e){return L.error("Erreur lors de la récupération du statut de rattachement:",e),{isLinked:!1}}}transformLinkResponse(e){return"error"===e.status?{status:"error",message:e.message}:{status:"success",message:e.message,linkedThemes:e.data?.linkedThemes?.map(e=>({id:e.id,name:e.name,slug:e.slug,expiresAt:e.expiresAt})),starsRecovered:e.data?.starsRecovered}}transformStatusResponse(e){return"error"!==e.status&&e.data?{isLinked:e.data.isLinked,linkedAt:e.data.linkedAt,subscriberId:e.data.subscriberId,linkedThemes:e.data.linkedThemes?.map(e=>({id:e.id,name:e.name,slug:e.slug,expiresAt:e.expiresAt}))}:{isLinked:!1}}getErrorCode(e){const t=e.toLowerCase();return t.includes("invalide")||t.includes("introuvable")?"INVALID_CREDENTIALS":t.includes("déjà rattaché")||t.includes("already linked")?"ALREADY_LINKED":t.includes("expiré")||t.includes("expired")?"EXPIRED_ACCOUNT":"UNKNOWN_ERROR"}isUsingMock(){return De}},Oe={class:"bg-neutral-50 flex flex-1 justify-center items-center py-16"},We={class:"max-w-md mx-auto px-4 w-full"},$e={class:"bg-white rounded-md shadow-xl overflow-hidden"},Ze=F(e({__name:"LinkLegacyAccountPage",setup(e){const s=y(),l=_(),r=v("welcome"),n=v("login"),m=t(()=>l.isAuthenticated?["welcome","form","success"]:["welcome","auth","form","success"]),g=v(!1),b=v(""),x=v(null),h=v("forward"),A=()=>{h.value="forward";const e=m.value.indexOf(r.value),t=m.value[e+1];e<m.value.length-1&&t&&(r.value=t)},z=()=>{h.value="backward";const e=m.value.indexOf(r.value),t=m.value[e-1];e>0&&t&&(r.value=t)},E=()=>{n.value="login",A()},j=()=>{n.value="register",A()},I=()=>{A()},S=()=>{h.value="forward",r.value="form"},T=()=>{z()},M=e=>{n.value=e},F=async e=>{g.value=!0,b.value="";try{const t=await Ke.linkAccount(e);"success"===t.status?(x.value=t,R.success("Compte rattaché avec succès !"),await l.refreshUser(),A()):b.value=t.message||"Une erreur est survenue lors du rattachement."}catch(t){L.error("Erreur lors du rattachement:",t),b.value=C(t)}finally{g.value=!1}},P=()=>{b.value="",z()};return w(async()=>{if(await l.waitForInitialization(),l.isAuthenticated)try{(await Ke.getLinkingStatus()).isLinked&&(R.info("Votre compte est déjà rattaché."),s.replace("/mon-compte"))}catch(e){}}),p(()=>l.isAuthenticated,e=>{e&&"auth"===r.value&&(h.value="forward",r.value="form")}),(e,t)=>(a(),i(N,null,{default:d(()=>[o("section",Oe,[o("div",We,[o("div",$e,[f(k,{name:"forward"===h.value?"slide-left":"slide-right",mode:"out-in"},{default:d(()=>["welcome"===r.value?(a(),i(c(ce),{key:"welcome","is-authenticated":c(l).isAuthenticated,onLogin:E,onRegister:j,onContinue:I},null,8,["is-authenticated"])):"auth"===r.value?(a(),i(c(xe),{key:"auth","initial-mode":n.value,onNext:S,onBack:T,onChangeMode:M},null,8,["initial-mode"])):"form"===r.value?(a(),i(c(Ae),{key:"form","is-submitting":g.value,"error-message":b.value,onSubmit:F,onBack:P},null,8,["is-submitting","error-message"])):"success"===r.value&&x.value?(a(),i(c(qe),{key:"success",result:x.value},null,8,["result"])):u("",!0)]),_:1},8,["name"]),f(c(te),{"current-step":r.value,steps:m.value},null,8,["current-step","steps"])])])])]),_:1}))}}),[["__scopeId","data-v-8830c81e"]]);export{Ze as default};
