import{n as e,N as a,a as l}from"./news.service-C63P7LKh.js";import{b as s,c as t,F as u,d as i,e as r}from"./DefaultLayout.vue_vue_type_script_setup_true_lang-Br6uEOr3.js";import{N as o}from"./NewsCatalogCard-BhIPrePg.js";import{_ as n}from"./Skeleton.vue_vue_type_script_setup_true_lang-C_McNZtf.js";import{_ as d}from"./Card.vue_vue_type_script_setup_true_lang-BImqj4dv.js";import{A as c,G as v,H as p,u as m,I as f,U as g,K as y,l as _,a as x,m as h,W as b,Q as w,L as k,V as j,Z as C,F as N,a5 as S}from"./vue-vendor-BHZkLje3.js";import{_ as z,L as A}from"./NewsEmptyState.vue_vue_type_script_setup_true_lang-Cs_-YvD5.js";import{_ as L,a as E,b as F}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-DaA9Wpsy.js";import"./index-BamJDk-5.js";import"./ui-vendor-Dpzf4R5k.js";import"./BookmarkButton.vue_vue_type_script_setup_true_lang-DXDfxjsK.js";import"./AspectRatio.vue_vue_type_script_setup_true_lang-CQwfCPqO.js";const T={class:"relative"},B={class:"aspect-video"},V={class:"p-4 flex flex-col flex-1"},I={class:"space-y-2 mb-3"},U={class:"space-y-1.5 mb-3"},D={class:"flex items-center gap-3 mt-auto"},G=c({__name:"NewsCatalogCardSkeleton",setup:e=>(e,a)=>(p(),v(m(d),{class:"overflow-hidden border border-secondary/10 py-0 gap-0 h-full flex flex-col"},{default:f(()=>[g("div",T,[g("div",B,[y(m(n),{class:"absolute inset-0"})]),y(m(n),{class:"absolute top-3 left-3 h-5 w-16 rounded-full bg-neutral-300/80"})]),g("div",V,[g("div",I,[y(m(n),{class:"h-5 w-full rounded"}),y(m(n),{class:"h-5 w-2/3 rounded"})]),g("div",U,[y(m(n),{class:"h-3.5 w-full rounded"}),y(m(n),{class:"h-3.5 w-4/5 rounded"})]),g("div",D,[y(m(n),{class:"h-3 w-20 rounded"}),y(m(n),{class:"h-3 w-12 rounded"})])])]),_:1}))}),P={class:"min-h-screen bg-neutral-50"},R={class:"bg-secondary border-b border-neutral-200"},Z={class:"max-w-7xl mx-auto px-4 md:px-8"},H={class:"py-8 md:py-12"},K={class:"flex flex-col md:flex-row md:items-end md:justify-between gap-4"},O={class:"text-secondary-foreground"},Q={class:"font-semibold text-primary"},W={key:0,class:"text-primary"},q={class:"pb-4"},J={class:"flex items-center gap-2"},M={class:"ml-1 px-1.5 py-0.5 text-[10px] font-bold rounded-md bg-neutral-200/80 data-[state=active]:bg-primary/10 data-[state=active]:text-secondary"},X={class:"max-w-7xl mx-auto px-4 md:p-8"},Y={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2"},$={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2",style:{"grid-auto-flow":"dense"}},ee={key:2,class:"flex justify-center mt-12"},ae={key:3,class:"flex items-center justify-center gap-4 mt-12"},le=c({__name:"NewsCatalogPage",setup(n){const d=_("all"),c=_([]),T=_(!0),B=_(!1),V=_(null),I=_(1),U=_(0),D=a.DEFAULT_PAGE_SIZE,le=x(()=>({fileLines:s.fas?.["file-lines"],video:s.fas?.video,bolt:s.fas?.bolt,newspaper:s.far?.newspaper})),se=[{value:"all",label:"Tout",icon:"newspaper"},{value:"article",label:"Articles",icon:"fileLines"},{value:"video",label:"Vidéos",icon:"video"},{value:"brief",label:"Brèves",icon:"bolt"}],te=x(()=>"all"===d.value?c.value:c.value.filter(e=>e.type===d.value)),ue=x(()=>{const e=te.value;if(e.length<3)return new Set;const a=new Set,l=e.map((e,a)=>a);for(let s=l.length-1;s>0&&a.size<2;s--){const t=(7*s+13*e.length)%(s+1);[l[s],l[t]]=[l[t],l[s]],a.add(e[l[s]].id)}return a}),ie=x(()=>{const e={all:c.value.length,article:0,video:0,brief:0};return c.value.forEach(a=>{e[a.type]++}),e}),re=x(()=>c.value.length<U.value),oe=async()=>{T.value=!0,V.value=null,I.value=1;try{const a=await e.fetchNews({pageSize:2*D});c.value=a.items,U.value=a.total}catch(a){V.value="Impossible de charger les actualités"}finally{T.value=!1}},ne=async()=>{if(!B.value&&re.value){B.value=!0;try{I.value++;const a=await e.fetchNews({page:I.value,pageSize:2*D});c.value.push(...a.items)}catch(a){I.value--}finally{B.value=!1}}},de=e=>{d.value=String(e)};return h(oe),(e,a)=>(p(),v(t,null,{default:f(()=>[g("div",P,[g("header",R,[g("div",Z,[g("div",H,[g("div",K,[a[0]||(a[0]=g("div",null,[g("h1",{class:"font-heading font-bold text-4xl md:text-5xl text-primary"}," Toutes nos publications ")],-1)),g("p",O,[g("span",Q,j(te.value.length),1),b(" "+j(te.value.length>1?"publications":"publication")+" ",1),"all"!==d.value?(p(),w("span",W," · "+j(m(l)[d.value]),1)):k("",!0)])])]),g("div",q,[y(m(F),{"default-value":d.value,"onUpdate:modelValue":de},{default:f(()=>[y(m(L),{class:"h-auto p-1 bg-white rounded-lg"},{default:f(()=>[(p(),w(N,null,C(se,e=>y(m(E),{key:e.value,value:e.value,class:"relative px-4 py-2.5 rounded-lg font-medium text-sm transition-all duration-200 hover:cursor-pointer data-[state=active]:bg-primary data-[state=active]:text-secondary data-[state=active]:shadow-sm data-[state=inactive]:text-secondary data-[state=inactive]:hover:bg-primary/20"},{default:f(()=>[g("span",J,[le.value[e.icon]?(p(),v(m(u),{key:0,icon:le.value[e.icon],class:"w-3.5 h-3.5"},null,8,["icon"])):k("",!0),b(" "+j(e.label)+" ",1),g("span",M,j(ie.value[e.value]),1)])]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["default-value"])])])]),g("main",X,[T.value?(p(),w("div",Y,[(p(),w(N,null,C(6,e=>y(G,{key:e})),64))])):V.value?(p(),v(z,{key:1,type:"error",description:V.value,"show-action":"","action-label":"Réessayer",onAction:oe},null,8,["description"])):(p(),w(N,{key:2},[0===te.value.length?(p(),v(z,{key:0,type:"all"===d.value?"catalog":"filter"},null,8,["type"])):(p(),w("div",$,[(p(!0),w(N,null,C(te.value,e=>(p(),v(o,{key:e.id,item:e,featured:ue.value.has(e.id),horizontal:ue.value.has(e.id),class:S(ue.value.has(e.id)?"sm:col-span-2":"")},null,8,["item","featured","horizontal","class"]))),128))])),re.value&&"all"===d.value?(p(),w("div",ee,[y(m(i),{variant:"outline",size:"lg",rounded:"lg",disabled:B.value,class:"px-8 text-secondary hover:text-secondary",onClick:ne},{default:f(()=>[B.value?(p(),v(m(A),{key:0,class:"w-4 h-4 animate-spin mr-2"})):k("",!0),b(" "+j(B.value?"Chargement...":"Voir plus de publications"),1)]),_:1},8,["disabled"])])):te.value.length>0&&"all"===d.value?(p(),w("div",ae,[y(m(r),{class:"flex-1 max-w-24"}),a[1]||(a[1]=g("p",{class:"text-sm text-muted-foreground"}," Fin du catalogue ",-1)),y(m(r),{class:"flex-1 max-w-24"})])):k("",!0)],64))])])]),_:1}))}});export{le as default};
