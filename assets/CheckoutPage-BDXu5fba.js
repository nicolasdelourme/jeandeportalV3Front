import{a as e,A as a,l as t,Q as l,H as s,K as r,u as n,I as u,G as o,L as i,W as c,V as d,U as m,a5 as p,F as v,Z as f,aj as y,y as b,n as x,m as h,w as g,ae as _,ad as k}from"./vue-vendor-BHZkLje3.js";import{b as w,l as E,e as C,d as A,f as P,t as j}from"./index-BamJDk-5.js";import{u as V,o as T}from"./oneclick-basket.store-Baqgc6CO.js";import{b as R,F as I,e as N,u as S,c as F,d as D}from"./DefaultLayout.vue_vue_type_script_setup_true_lang-Br6uEOr3.js";import{_ as L}from"./Card.vue_vue_type_script_setup_true_lang-BImqj4dv.js";import{_ as K}from"./CardContent.vue_vue_type_script_setup_true_lang-CzZI-ZF8.js";import{a as z,_ as U}from"./CardTitle.vue_vue_type_script_setup_true_lang-CCW9Rm4y.js";import{_ as $}from"./Label.vue_vue_type_script_setup_true_lang-BNDbxbZU.js";import{_ as M}from"./Checkbox.vue_vue_type_script_setup_true_lang-EZWj0bVF.js";import{_ as q,a as B}from"./index-j_h2RxZR.js";import{_ as O}from"./AlertTitle.vue_vue_type_script_setup_true_lang-3SqVJcCT.js";import{_ as W,a as Y,b as H,l as Q}from"./index-5-l_LvkH.js";import{_ as Z}from"./CardDescription.vue_vue_type_script_setup_true_lang-Cw5K8ggb.js";import{_ as G}from"./Skeleton.vue_vue_type_script_setup_true_lang-C_McNZtf.js";import"./ui-vendor-Dpzf4R5k.js";class J extends Error{code;statusCode;constructor(e,a,t){super(e),this.name="PaymentError",this.code=a,this.statusCode=t}}const X=new class{async checkout(e){try{const a={basketCode:e},t=await w.post("/checkout",a);if("error"===t.status||!t.stripePublicKey)throw new J(t.message||"Erreur lors du checkout","INIT_FAILED");return{publicKey:t.stripePublicKey}}catch(a){if(a instanceof J)throw a;E.error("❌ [PAYMENT SERVICE] Erreur lors du checkout:",a);const e=C(a),t=A(a);if(401===e)throw new J("Authentification requise","INIT_FAILED",401);throw new J(t?.message||"Erreur lors du checkout","NETWORK_ERROR",e)}}async initPayment(e,a,t,l="eur"){try{const s={basketCode:e,adressId:a,billAdressId:t,currency:l},r=await w.post("/initPayment",s);if("error"===r.status||!r.client_secret||!r.stripePublicKey)throw new J(r.message||"Impossible d'initialiser le paiement","INIT_FAILED");return{clientSecret:r.client_secret,publicKey:r.stripePublicKey}}catch(s){if(s instanceof J)throw s;E.error("❌ [PAYMENT SERVICE] Erreur lors de l'initialisation:",s);const e=C(s),a=A(s);if(404===e)throw new J("Panier non trouvé ou expiré","BASKET_EXPIRED",404);throw new J(a?.message||"Erreur lors de l'initialisation du paiement","NETWORK_ERROR",e)}}};const ee={class:"space-y-1.5"},ae={key:0,class:"min-w-0 flex-1"},te={class:"text-sm font-medium text-foreground truncate"},le={class:"text-xs text-muted-foreground truncate"},se={key:1,class:"text-sm text-muted-foreground"},re={class:"mt-1.5 rounded-lg border border-input bg-background divide-y divide-border"},ne=["onClick"],ue={key:0,class:"w-2 h-2 rounded-full bg-foreground"},oe={class:"min-w-0 flex-1"},ie={class:"text-sm font-medium text-foreground truncate"},ce={key:0,class:"text-muted-foreground font-normal"},de={class:"text-xs text-muted-foreground truncate"},me=a({__name:"AddressSelect",props:{addresses:{},modelValue:{},label:{},icon:{}},emits:["update:modelValue"],setup(a,{emit:b}){const x=a,h=b,g=t(!1),_=e(()=>({chevronDown:R.fas?.["chevron-down"],plus:R.fas?.plus}));function k(e){const a=[e.line1];return e.line2&&a.push(e.line2),a.push(`${e.zipcode} ${e.city}`),a.join(", ")}function w(){return x.addresses.find(e=>Number(e.id)===x.modelValue)}return(e,t)=>(s(),l("div",ee,[r(n($),{class:"flex items-center gap-2 text-sm font-medium"},{default:u(()=>[a.icon?(s(),o(n(I),{key:0,icon:a.icon,class:"h-4 w-4 text-muted-foreground"},null,8,["icon"])):i("",!0),c(" "+d(a.label),1)]),_:1}),r(n(W),{open:g.value,"onUpdate:open":t[0]||(t[0]=e=>g.value=e)},{default:u(()=>[r(n(Y),{class:"flex items-center justify-between w-full rounded-lg border border-input bg-background px-3 py-2.5 text-left hover:bg-accent/50 transition-colors cursor-pointer"},{default:u(()=>[w()?(s(),l("div",ae,[m("p",te,d(w().firstName)+" "+d(w().lastName),1),m("p",le,d(k(w())),1)])):(s(),l("span",se,"Choisir une adresse")),_.value.chevronDown?(s(),o(n(I),{key:2,icon:_.value.chevronDown,class:p(["h-4 w-4 text-muted-foreground transition-transform duration-200 ml-2 shrink-0",g.value?"rotate-180":""])},null,8,["icon","class"])):i("",!0)]),_:1}),r(n(H),{class:"overflow-hidden data-[state=open]:animate-collapsible-down data-[state=closed]:animate-collapsible-up"},{default:u(()=>[m("div",re,[(s(!0),l(v,null,f(a.addresses,e=>(s(),l("button",{key:e.id,type:"button",class:"flex items-center gap-3 w-full px-3 py-2.5 text-left hover:bg-accent/50 transition-colors first:rounded-t-lg",onClick:a=>{return t=Number(e.id),h("update:modelValue",t),void(g.value=!1);var t}},[m("span",{class:p(["shrink-0 flex items-center justify-center w-4 h-4 rounded-full border-2 transition-colors",Number(e.id)===a.modelValue?"border-foreground":"border-muted-foreground/40"])},[Number(e.id)===a.modelValue?(s(),l("span",ue)):i("",!0)],2),m("div",oe,[m("p",ie,[c(d(e.firstName)+" "+d(e.lastName)+" ",1),e.recipient?(s(),l("span",ce," — "+d(e.recipient),1)):i("",!0)]),m("p",de,d(k(e)),1)])],8,ne))),128)),r(n(y),{to:"/mon-compte",class:"flex items-center gap-2 w-full px-3 py-2.5 text-sm text-muted-foreground hover:text-foreground hover:bg-accent/50 transition-colors rounded-b-lg"},{default:u(()=>[_.value.plus?(s(),o(n(I),{key:0,icon:_.value.plus,class:"h-3 w-3"},null,8,["icon"])):i("",!0),t[1]||(t[1]=c(" Ajouter une adresse ",-1))]),_:1})])]),_:1})]),_:1},8,["open"])]))}}),pe={class:"text-sm font-medium text-neutral-500 mb-1"},ve={class:"text-sm"},fe=a({__name:"AddressSummary",props:{address:{},label:{}},setup(e){function a(e){if(!e)return"";const a=[e.line1];return e.line2&&a.push(e.line2),a.push(`${e.zipcode} ${e.city}`),a.join(", ")}return(t,r)=>(s(),l("div",null,[m("p",pe,d(e.label),1),m("p",ve,d(a(e.address)),1)]))}}),ye={class:"mb-3 underline font-semibold"},be={class:"font-heading font-bold text-lg text-foreground mb-2"},xe={class:"text-sm text-muted-foreground mb-4"},he={class:"space-y-2 text-sm"},ge={key:0,class:"flex items-center gap-2 text-success"},_e={class:"flex items-center gap-2 text-muted-foreground"},ke={class:"space-y-2"},we={class:"flex justify-between text-sm"},Ee={key:0,class:"flex justify-between text-sm text-success"},Ce={class:"flex justify-between font-bold text-lg"},Ae={class:"text-secondary"},Pe={key:1,class:"text-xs text-muted-foreground"},je={class:"pt-2 border-t border-border"},Ve={class:"text-xs text-muted-foreground flex items-start gap-2"},Te=a({__name:"CheckoutSubscriptionSummary",props:{item:{},totalPrice:{}},setup(a){const t=a,v=e(()=>({star:R.fas?.star,clock:R.fas?.clock,creditCard:R.fas?.["credit-card"],checkCircle:R.fas?.["check-circle"]}));function f(e){return new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(e)}const y=e(()=>"monthly"===t.item.interval?"/mois":"/an"),b={bg:"bg-[var(--color-theme-metaux-light)]",border:"border-[var(--color-theme-metaux)]",text:"text-[var(--color-theme-metaux-dark)]"},x=e(()=>({metaux:{bg:"bg-[var(--color-theme-metaux-light)]",border:"border-[var(--color-theme-metaux)]",text:"text-[var(--color-theme-metaux-dark)]"},portefeuille:{bg:"bg-[var(--color-theme-portefeuille-light)]",border:"border-[var(--color-theme-portefeuille)]",text:"text-[var(--color-theme-portefeuille-dark)]"},liberte:{bg:"bg-[var(--color-theme-liberte-light)]",border:"border-[var(--color-theme-liberte)]",text:"text-[var(--color-theme-liberte-dark)]"},bonus:{bg:"bg-neutral-100",border:"border-neutral-800",text:"text-neutral-800"}}[t.item.theme]??b));return(e,t)=>(s(),o(n(L),{class:"sticky top-24 border-0"},{default:u(()=>[r(n(U),null,{default:u(()=>[r(n(z),null,{default:u(()=>[...t[0]||(t[0]=[c("Votre abonnement",-1)])]),_:1})]),_:1}),r(n(K),{class:"space-y-4"},{default:u(()=>[m("div",{class:p(["p-4 rounded-lg border-2",[x.value.bg,x.value.border]])},[m("p",ye,d(a.item.oneClickName),1),m("h3",be,d(a.item.name),1),m("p",xe,d(a.item.description),1),m("div",he,[a.item.trialDays>0?(s(),l("div",ge,[v.value.clock?(s(),o(n(I),{key:0,icon:v.value.clock,class:"h-4 w-4"},null,8,["icon"])):i("",!0),m("span",null,d(a.item.trialDays)+" jours d'essai gratuit",1)])):i("",!0),m("div",_e,[v.value.creditCard?(s(),o(n(I),{key:0,icon:v.value.creditCard,class:"h-4 w-4"},null,8,["icon"])):i("",!0),m("span",null,"Facturation "+d("monthly"===a.item.interval?"mensuelle":"annuelle"),1)])])],2),r(n(N)),m("div",ke,[m("div",we,[t[1]||(t[1]=m("span",null,"Abonnement",-1)),m("span",null,d(f(a.item.price))+d(y.value),1)]),a.item.trialDays>0?(s(),l("div",Ee,[t[2]||(t[2]=m("span",null,"Essai gratuit",-1)),m("span",null,d(a.item.trialDays)+" jours",1)])):i("",!0),r(n(N)),m("div",Ce,[t[3]||(t[3]=m("span",null,"A payer aujourd'hui",-1)),m("span",Ae,d(a.item.trialDays>0?f(0):f(a.totalPrice)),1)]),a.item.trialDays>0?(s(),l("p",Pe," Premier prelevement de "+d(f(a.totalPrice))+" apres "+d(a.item.trialDays)+" jours ",1)):i("",!0)]),m("div",je,[m("p",Ve,[v.value.checkCircle?(s(),o(n(I),{key:0,icon:v.value.checkCircle,class:"h-3 w-3 mt-0.5 text-success shrink-0"},null,8,["icon"])):i("",!0),t[4]||(t[4]=m("span",null,"Sans engagement. Annulez a tout moment depuis votre espace membre.",-1))])])]),_:1})]),_:1}))}}),Re={class:"space-y-3"},Ie={class:"w-12 h-12 shrink-0 bg-neutral-100 rounded-lg overflow-hidden"},Ne=["src","alt"],Se={class:"flex-1 min-w-0"},Fe={class:"text-sm font-medium truncate"},De={class:"text-sm text-neutral-500"},Le={class:"text-sm font-medium"},Ke={class:"space-y-2"},ze={class:"flex justify-between text-sm"},Ue={class:"flex justify-between text-sm"},$e={class:"flex justify-between font-bold text-lg"},Me={class:"text-secondary"},qe=a({__name:"CheckoutShopSummary",props:{items:{},subtotalExclVAT:{},vatAmount:{},totalPrice:{},title:{}},setup(e){function a(e){return new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(e)}return(t,p)=>(s(),o(n(L),{class:"sticky top-24 border-0"},{default:u(()=>[r(n(U),null,{default:u(()=>[r(n(z),null,{default:u(()=>[c(d(e.title),1)]),_:1})]),_:1}),r(n(K),{class:"space-y-4"},{default:u(()=>[m("div",Re,[(s(!0),l(v,null,f(e.items,e=>(s(),l("div",{key:e.itemId,class:"flex gap-3"},[m("div",Ie,[e.images?.[0]?(s(),l("img",{key:0,src:e.images[0],alt:e.name,class:"w-full h-full object-cover"},null,8,Ne)):i("",!0)]),m("div",Se,[m("p",Fe,d(e.name),1),m("p",De,"Qté: "+d(e.quantity),1)]),m("p",Le,d(a(e.price*e.quantity)),1)]))),128))]),r(n(N)),m("div",Ke,[m("div",ze,[p[0]||(p[0]=m("span",null,"Sous-total HT",-1)),m("span",null,d(a(e.subtotalExclVAT)),1)]),m("div",Ue,[p[1]||(p[1]=m("span",null,"TVA",-1)),m("span",null,d(a(e.vatAmount)),1)]),r(n(N)),m("div",$e,[p[2]||(p[2]=m("span",null,"Total TTC",-1)),m("span",Me,d(a(e.totalPrice)),1)])])]),_:1})]),_:1}))}});const Be={class:"flex items-center gap-4 mb-4"},Oe={class:"flex items-center justify-center w-full gap-4"},We=a({__name:"StripeCardForm",props:{publicKey:{}},emits:["ready","error"],setup(a,{expose:l,emit:d}){const p=a,v=d,{stripe:f,cardElement:y,isReady:_,error:k,mount:w,cleanup:E}=function(e={}){const{locale:a="fr",primaryColor:l="#0F766E",hidePostalCode:s=!0}=e,r=t(null),n=t(null),u=t(null),o=t(!1),i=t(null);function c(){u.value&&(u.value.unmount(),u.value=null),n.value=null,r.value=null,o.value=!1,i.value=null}return b(()=>{c()}),{stripe:r,elements:n,cardElement:u,isReady:o,error:i,mount:async function(e,t){i.value=null,o.value=!1;try{if(r.value=await Q(e),!r.value)throw new Error("Impossible de charger Stripe");await x(),n.value=r.value.elements({locale:a,appearance:{theme:"stripe",variables:{colorPrimary:l,borderRadius:"8px"}}}),u.value=n.value.create("card",{style:{base:{fontSize:"16px",color:"#1f2937",fontFamily:"system-ui, -apple-system, sans-serif","::placeholder":{color:"#9ca3af"}},invalid:{color:"#ef4444"}},hidePostalCode:s}),u.value.mount(t),u.value.on("ready",()=>{o.value=!0})}catch(c){throw i.value=c instanceof Error?c.message:"Erreur lors du chargement de Stripe",c}},cleanup:c}}(),C=e(()=>({lock:R.fas?.lock,ccVisa:R.fab?.["cc-visa"],ccMastercard:R.fab?.["cc-mastercard"],ccAmex:R.fab?.["cc-amex"]}));return h(async()=>{if(p.publicKey)try{await w(p.publicKey,"#card-element")}catch(e){v("error",e instanceof Error?e.message:"Erreur Stripe")}}),g(_,e=>{e&&f.value&&y.value&&v("ready",f.value,y.value)}),g(k,e=>{e&&v("error",e)}),l({cleanup:E,stripe:f,cardElement:y,isReady:_}),(e,a)=>(s(),o(n(L),{class:"border-secondary rounded-lg"},{default:u(()=>[r(n(U),null,{default:u(()=>[r(n(z),{class:"flex items-center gap-2"},{default:u(()=>[C.value.lock?(s(),o(n(I),{key:0,icon:C.value.lock,class:"h-5 w-5"},null,8,["icon"])):i("",!0),a[0]||(a[0]=c(" Paiement sécurisé ",-1))]),_:1}),r(n(Z),null,{default:u(()=>[...a[1]||(a[1]=[c(" Vos informations de paiement sont protégées par Stripe ",-1)])]),_:1})]),_:1}),r(n(K),null,{default:u(()=>[m("div",Be,[m("div",Oe,[C.value.ccVisa?(s(),o(n(I),{key:0,icon:C.value.ccVisa,class:"h-16 w-16 text-[#1A1F71] fa-2x"},null,8,["icon"])):i("",!0),C.value.ccMastercard?(s(),o(n(I),{key:1,icon:C.value.ccMastercard,class:"h-16 w-16 text-[#EB001B] fa-2x"},null,8,["icon"])):i("",!0),C.value.ccAmex?(s(),o(n(I),{key:2,icon:C.value.ccAmex,class:"h-16 w-16 text-[#006FCF] fa-2x"},null,8,["icon"])):i("",!0)])]),a[2]||(a[2]=m("div",{id:"card-element",class:"p-4 border border-gray-200 rounded-lg min-h-[50px]"},null,-1)),n(_)?i("",!0):(s(),o(n(G),{key:0,class:"h-12 w-full mt-2"}))]),_:1})]),_:1}))}}),Ye={class:"min-h-screen bg-gray-50"},He={class:"max-w-4xl mx-auto px-4 py-6"},Qe={class:"grid lg:grid-cols-3 gap-8"},Ze={class:"lg:col-span-2 space-y-4"},Ge={class:"flex items-center justify-between"},Je={class:"text-2xl font-bold font-heading text-foreground"},Xe={class:"text-sm text-muted-foreground mt-0.5"},ea={key:0,class:"flex items-center gap-2.5"},aa={key:1},ta={key:2},la={class:"flex gap-4"},sa={key:1},ra={key:2},na={class:"text-2xl font-bold mb-2"},ua={class:"text-neutral-600 mb-4"},oa={class:"text-neutral-600 mb-4"},ia={class:"flex gap-4 justify-center"},ca={class:"lg:col-span-1"},da=a({__name:"CheckoutPage",setup(a){const p=k(),f=_(),{user:y}=S(),b=e(()=>f.meta.checkoutType||"shop"),{basketCode:x,isEmpty:g,items:w,totalPrice:C,subtotalExclVAT:A,vatAmount:Y,initPayment:Q,confirmPayment:Z,resetBasket:G,checkoutTitle:J,isSubscription:ee,successMessage:ae,buttonLabel:te}=function(a){const t=P(),l=V(),s=e(()=>"shop"===a?t.basketCode:l.basketCode),r=e(()=>"shop"===a?t.isEmpty:l.isEmpty),n=e(()=>"shop"===a?t.items:l.items),u=e(()=>"shop"===a?t.subtotal:l.totalPrice),o=e(()=>"shop"===a?t.subtotalExclVAT:l.totalPrice/1.2),i=e(()=>"shop"===a?t.vatAmount:l.totalPrice-o.value),c=e(()=>"shop"===a?t.isLoading:l.isLoading);return{basketCode:s,isEmpty:r,items:n,totalPrice:u,subtotalExclVAT:o,vatAmount:i,isLoading:c,initPayment:async function(e,t){const l=s.value;if(!l)throw new Error("Pas de panier actif");return"shop"===a?(await X.checkout(l),X.initPayment(l,e,t,"eur")):(await T.checkout(l),T.initPayment(l,e,t))},confirmPayment:async function(e,t,l,s){if("shop"===a){const{error:a,paymentIntent:r}=await e.confirmCardPayment(l,{payment_method:{card:t,billing_details:s}});return a?{success:!1,error:a.message||"Erreur lors du paiement"}:"succeeded"===r?.status||"requires_action"===r?.status||"processing"===r?.status?{success:!0}:{success:!1,error:`Statut inattendu: ${r?.status}`}}{const{error:a,setupIntent:r}=await e.confirmCardSetup(l,{payment_method:{card:t,billing_details:s}});return a?{success:!1,error:a.message||"Erreur lors de la configuration"}:"succeeded"===r?.status||"requires_action"===r?.status?{success:!0}:{success:!1,error:`Statut inattendu: ${r?.status}`}}},resetBasket:function(){"shop"===a?t.resetCart():l.resetBasket()},checkoutTitle:"shop"===a?"Votre commande":"Votre abonnement",isSubscription:"oneclick"===a,successMessage:"shop"===a?"Merci pour votre commande. Vous allez recevoir un email de confirmation.":"Votre abonnement est active ! Vous allez recevoir un email de confirmation.",buttonLabel:e=>"shop"===a?`Payer ${e}`:`Souscrire pour ${e}/mois`}}(b.value),le=t("addresses"),se=t(!1),re=t(null),ne=t(null),ue=t(null),oe=t(!0),ie=t(null),ce=t(null),de=t(null),pe=t(null),ve=t(null),ye=t(!1),be=e(()=>({shippingFast:R.fas?.["shipping-fast"],fileInvoice:R.fas?.["file-invoice"],creditCard:R.fas?.["credit-card"],checkCircle:R.fas?.["check-circle"],exclamationTriangle:R.fas?.["exclamation-triangle"],arrowLeft:R.fas?.["arrow-left"],spinner:R.fas?.spinner})),xe=e(()=>y.value?.addresses||[]),he=e(()=>xe.value.length>0),ge=e(()=>oe.value?ne.value:ue.value),_e=e(()=>null!==ne.value&&null!==ge.value),ke=e(()=>xe.value.find(e=>Number(e.id)===ne.value)),we=e(()=>{const e=ge.value;return xe.value.find(a=>Number(a.id)===e)}),Ee=e(()=>ee?"Finaliser mon abonnement":"Finaliser ma commande"),Ce=e(()=>ee?"Configurez votre méthode de paiement pour votre abonnement":"Confirmez vos adresses et procédez au paiement sécurisé"),Ae=e(()=>ee?"/academie":"/panier"),Pe=e(()=>{const e=w.value[0];return ee&&e&&("planId"in(a=e)&&"interval"in a)?e:null;var a}),je=e(()=>ee?[]:w.value);async function Ve(){if(_e.value&&x.value){se.value=!0,re.value=null;try{const{clientSecret:e,publicKey:a}=await Q(ne.value,ge.value);pe.value=e,ve.value=a,le.value="payment"}catch(e){E.error("Erreur initialisation paiement:",e);const a=e instanceof Error?e.message:"Impossible d'initialiser le paiement";re.value=a,j.error(a)}finally{se.value=!1}}}function Re(){le.value="addresses",pe.value=null,ve.value=null,ye.value=!1,ce.value=null,de.value=null,re.value=null,ie.value?.cleanup()}function Ie(e,a){ce.value=e,de.value=a,ye.value=!0}function Ne(e){re.value=e,j.error(e)}async function Se(){if(ce.value&&de.value&&pe.value){se.value=!0,re.value=null;try{const e=await Z(ce.value,de.value,pe.value,{name:`${we.value?.firstName} ${we.value?.lastName}`,address:{line1:we.value?.line1,line2:we.value?.line2||void 0,postal_code:we.value?.zipcode,city:we.value?.city,country:"FR"}});if(!e.success)throw new Error(e.error||"Erreur lors du paiement");le.value="success",j.success(ee?"Abonnement activé !":"Paiement réussi !"),G(),setTimeout(()=>{p.push("/mon-compte")},3e3)}catch(e){E.error("Erreur confirmation paiement:",e);const a=e instanceof Error?e.message:"Erreur lors du paiement";re.value=a,j.error(a)}finally{se.value=!1}}}function Fe(){p.push(Ae.value)}return h(async()=>{if(g.value||!x.value)return j.error(ee?"Aucun abonnement sélectionné":"Votre panier est vide"),void p.push(Ae.value);const e=xe.value.find(e=>e.isDefaultShipping),a=xe.value.find(e=>e.isDefaultBilling);e?.id?ne.value=Number(e.id):xe.value.length>0&&xe.value[0]?.id&&(ne.value=Number(xe.value[0].id)),a?.id?ue.value=Number(a.id):xe.value.length>0&&xe.value[0]?.id&&(ue.value=Number(xe.value[0].id)),ee||(oe.value=ne.value===ue.value)}),(e,a)=>(s(),o(F,null,{default:u(()=>[m("div",Ye,[m("section",He,[m("div",Qe,[m("div",Ze,[m("div",Ge,[m("div",null,[m("h1",Je,d(Ee.value),1),m("p",Xe,d(Ce.value),1)]),r(n(D),{variant:"ghost",color:"secondary",size:"sm",onClick:Fe},{default:u(()=>[be.value.arrowLeft?(s(),o(n(I),{key:0,icon:be.value.arrowLeft,class:"h-4 w-4 mr-1.5"},null,8,["icon"])):i("",!0),c(" "+d(n(ee)?"Retour":"Panier"),1)]),_:1})]),re.value&&"error"!==le.value?(s(),o(n(q),{key:0,variant:"destructive"},{default:u(()=>[be.value.exclamationTriangle?(s(),o(n(I),{key:0,icon:be.value.exclamationTriangle,class:"h-4 w-4"},null,8,["icon"])):i("",!0),r(n(O),null,{default:u(()=>[...a[4]||(a[4]=[c("Erreur",-1)])]),_:1}),r(n(B),null,{default:u(()=>[c(d(re.value),1)]),_:1})]),_:1})):i("",!0),"addresses"===le.value?(s(),l(v,{key:1},[he.value?(s(),o(n(L),{key:1,class:"border-secondary rounded-lg"},{default:u(()=>[r(n(K),{class:"pt-6 pb-5 space-y-5"},{default:u(()=>[r(me,{modelValue:ne.value,"onUpdate:modelValue":a[1]||(a[1]=e=>ne.value=e),addresses:xe.value,label:n(ee)?"Adresse de facturation":"Adresse de livraison",icon:be.value.shippingFast},null,8,["modelValue","addresses","label","icon"]),n(ee)?i("",!0):(s(),l("div",ea,[r(n(M),{id:"same-address","model-value":oe.value,"onUpdate:modelValue":a[2]||(a[2]=e=>oe.value=!0===e)},null,8,["model-value"]),r(n($),{for:"same-address",class:"cursor-pointer text-sm"},{default:u(()=>[...a[7]||(a[7]=[c(" Utiliser la même adresse pour la facturation ",-1)])]),_:1})])),r(n(W),{open:!oe.value&&!n(ee)},{default:u(()=>[r(n(H),{class:"overflow-hidden data-[state=open]:animate-collapsible-down data-[state=closed]:animate-collapsible-up"},{default:u(()=>[r(me,{modelValue:ue.value,"onUpdate:modelValue":a[3]||(a[3]=e=>ue.value=e),addresses:xe.value,label:"Adresse de facturation",icon:be.value.fileInvoice},null,8,["modelValue","addresses","icon"])]),_:1})]),_:1},8,["open"])]),_:1})]),_:1})):(s(),o(n(L),{key:0,class:"border-secondary"},{default:u(()=>[r(n(K),{class:"py-8 text-center"},{default:u(()=>[a[6]||(a[6]=m("p",{class:"text-neutral-600 mb-4"},"Vous n'avez pas encore d'adresse enregistrée.",-1)),r(n(D),{onClick:a[0]||(a[0]=()=>n(p).push("/mon-compte"))},{default:u(()=>[...a[5]||(a[5]=[c("Ajouter une adresse",-1)])]),_:1})]),_:1})]),_:1})),r(n(D),{variant:"secondary",rounded:"lg",class:"w-full",disabled:!_e.value||se.value,onClick:Ve},{default:u(()=>[se.value&&be.value.spinner?(s(),o(n(I),{key:0,icon:be.value.spinner,class:"h-4 w-4 mr-2 animate-spin"},null,8,["icon"])):i("",!0),se.value?(s(),l("span",aa,"Chargement...")):(s(),l("span",ta,"Continuer vers le paiement"))]),_:1},8,["disabled"])],64)):i("",!0),"payment"===le.value?(s(),l(v,{key:2},[r(n(L),{class:"border-secondary rounded-lg"},{default:u(()=>[r(n(U),null,{default:u(()=>[r(n(z),null,{default:u(()=>[c(d(n(ee)?"Adresse sélectionnée":"Adresses sélectionnées"),1)]),_:1})]),_:1}),r(n(K),{class:"space-y-4"},{default:u(()=>[r(fe,{address:ke.value,label:n(ee)?"Facturation":"Livraison"},null,8,["address","label"]),n(ee)?i("",!0):(s(),l(v,{key:0},[r(n(N)),r(fe,{address:we.value,label:"Facturation"},null,8,["address"])],64)),r(n(D),{variant:"link",color:"secondary",size:"sm",class:"px-0 underline",onClick:Re},{default:u(()=>[c(" Modifier "+d(n(ee)?"l'adresse":"les adresses"),1)]),_:1})]),_:1})]),_:1}),ve.value?(s(),o(We,{key:0,ref_key:"stripeFormRef",ref:ie,"public-key":ve.value,onReady:Ie,onError:Ne},null,8,["public-key"])):i("",!0),m("div",la,[r(n(D),{variant:"outline",color:"secondary",rounded:"lg",class:"hover:bg-secondary hover:border-secondary",onClick:Re},{default:u(()=>[be.value.arrowLeft?(s(),o(n(I),{key:0,icon:be.value.arrowLeft,class:"h-4 w-4 mr-2"},null,8,["icon"])):i("",!0),a[8]||(a[8]=c(" Retour ",-1))]),_:1}),r(n(D),{class:"flex-1",disabled:!ye.value||se.value,rounded:"lg",variant:"secondary",onClick:Se},{default:u(()=>{return[se.value&&be.value.spinner?(s(),o(n(I),{key:0,icon:be.value.spinner,class:"h-4 w-4 mr-2 animate-spin"},null,8,["icon"])):i("",!0),se.value?(s(),l("span",sa,"Traitement en cours...")):(s(),l("span",ra,d(n(te)((e=n(C),new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(e)))),1))];var e}),_:1},8,["disabled"])])],64)):i("",!0),"processing"===le.value?(s(),o(n(L),{key:3,class:"border-secondary rounded-lg"},{default:u(()=>[r(n(K),{class:"py-16 text-center"},{default:u(()=>[be.value.spinner?(s(),o(n(I),{key:0,icon:be.value.spinner,class:"h-12 w-12 text-primary mx-auto mb-4 animate-spin"},null,8,["icon"])):i("",!0),a[9]||(a[9]=m("p",{class:"text-lg font-medium"},"Traitement de votre paiement...",-1)),a[10]||(a[10]=m("p",{class:"text-neutral-500"},"Veuillez ne pas fermer cette page",-1))]),_:1})]),_:1})):i("",!0),"success"===le.value?(s(),o(n(L),{key:4},{default:u(()=>[r(n(K),{class:"py-16 text-center"},{default:u(()=>[be.value.checkCircle?(s(),o(n(I),{key:0,icon:be.value.checkCircle,class:"h-16 w-16 text-green-500 mx-auto mb-4"},null,8,["icon"])):i("",!0),m("h2",na,d(n(ee)?"Abonnement activé !":"Paiement réussi !"),1),m("p",ua,d(n(ae)),1),a[11]||(a[11]=m("p",{class:"text-sm text-neutral-500"},"Redirection vers votre compte dans quelques secondes...",-1))]),_:1})]),_:1})):i("",!0),"error"===le.value?(s(),o(n(L),{key:5},{default:u(()=>[r(n(K),{class:"py-16 text-center"},{default:u(()=>[be.value.exclamationTriangle?(s(),o(n(I),{key:0,icon:be.value.exclamationTriangle,class:"h-16 w-16 text-red-500 mx-auto mb-4"},null,8,["icon"])):i("",!0),a[14]||(a[14]=m("h2",{class:"text-2xl font-bold mb-2"},"Erreur de paiement",-1)),m("p",oa,d(re.value||"Une erreur est survenue lors du paiement."),1),m("div",ia,[r(n(D),{variant:"outline",onClick:Fe},{default:u(()=>[...a[12]||(a[12]=[c("Retour",-1)])]),_:1}),r(n(D),{onClick:Re},{default:u(()=>[...a[13]||(a[13]=[c("Réessayer",-1)])]),_:1})])]),_:1})]),_:1})):i("",!0)]),m("div",ca,[n(ee)&&Pe.value?(s(),o(Te,{key:0,item:Pe.value,"total-price":n(C)},null,8,["item","total-price"])):(s(),o(qe,{key:1,items:je.value,"subtotal-excl-v-a-t":n(A),"vat-amount":n(Y),"total-price":n(C),title:n(J)},null,8,["items","subtotal-excl-v-a-t","vat-amount","total-price","title"]))])])])])]),_:1}))}});export{da as default};
